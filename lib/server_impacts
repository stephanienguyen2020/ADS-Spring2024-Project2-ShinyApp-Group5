# Define server logic
server <- function(input, output) {
  output$selectedPlot <- renderPlot({
    if (input$plotType == "Total Award Amount by Vendor State") {
      df <- read_csv("NonDisasterAssistanceFirefighterGrants.csv")
      award_amount_by_state <- df %>%
        group_by(vendorState) %>%
        summarise(TotalAwardAmount = sum(awardAmount)) %>%
        arrange(desc(TotalAwardAmount))
      ggplot(award_amount_by_state, aes(x=reorder(vendorState, -TotalAwardAmount), y=TotalAwardAmount)) +
        geom_bar(stat="identity", fill="steelblue") +
        theme_minimal() +
        labs(title="Total Award Amount by Vendor State", x="Vendor State", y="Total Award Amount") +
        theme(axis.text.x = element_text(angle=45, hjust=1))
      
    } else if (input$plotType == "Number of Fire Incidents by State") {
      df <- read.csv("DisasterDeclarationsSummaries.csv")
      df_fire <- df %>%
        filter(incidentType == "Fire")
      fire_incidents_by_state <- df_fire %>%
        group_by(state) %>%
        summarise(Count = n()) %>%
        arrange(desc(Count))
      ggplot(fire_incidents_by_state, aes(x=reorder(state, -Count), y=Count)) +
        geom_bar(stat="identity", fill="tomato") +
        theme_minimal() +
        labs(title="Number of Fire Incidents by State", x="State", y="Count of Incidents") +
        theme(axis.text.x = element_text(angle=45, hjust=1))
      
    } else if (input$plotType == "Total Fire Disaster Numbers by Fiscal Year") {
      df_disasters_updated <- read.csv("DisasterDeclarationsSummaries.csv")
      df_fire_updated <- df_disasters_updated %>%
        filter(incidentType == "Fire")
      fire_disasters_by_year_updated <- df_fire_updated %>%
        group_by(fyDeclared) %>%
        summarise(TotalFireDisasterNumber = n_distinct(disasterNumber))
      ggplot(fire_disasters_by_year_updated, aes(x=fyDeclared, y=TotalFireDisasterNumber)) +
        geom_line() +
        geom_point() +
        theme_minimal() +
        labs(title="Total Fire Disaster Numbers by Fiscal Year", x="Fiscal Year", y="Total Fire Disaster Number") +
        theme(axis.text.x = element_text(angle=45, hjust=1))
      
    } else if (input$plotType == "Total Award Amount by Fiscal Year") {
      df_grants <- read_csv("NonDisasterAssistanceFirefighterGrants.csv")
      total_award_by_year <- df_grants %>%
        group_by(fiscalYear) %>%
        summarise(TotalAwardAmount = sum(awardAmount))
      ggplot(total_award_by_year, aes(x=fiscalYear, y=TotalAwardAmount)) +
        geom_line() +
        geom_point() +
        theme_minimal() +
        labs(title="Total Award Amount by Fiscal Year", x="Fiscal Year", y="Total Award Amount") +
        theme(axis.text.x = element_text(angle=45, hjust=1))
    }
  })
}


